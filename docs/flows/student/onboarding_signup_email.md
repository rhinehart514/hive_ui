# Flow: Student - Sign Up with Email/Password\n\n**Version:** 1.0\n**Date:** YYYY-MM-DD\n**Owner:** [Your Name/Team]\n\n**Related Context:** [Hive UI Product Context & Documentation Principles](../../product_context.md)\n**Figma Link (Overall Flow):** [Link to Figma Frame for Email Signup Flow]\n\n---\n\n## 1. Title & Goal\n\n*   **Title:** Student Sign Up with Email/Password\n*   **Goal:** Allow a new user to create a Hive account using their email address and a chosen password, leading to the email verification step.\n\n---\n\n## 2. Persona & Prerequisites\n\n*   **Persona:** Student (New User)\n*   **Prerequisites:**\n    *   User has installed the Hive app (iOS, Android, or accessed Web).\n    *   User is on the initial Welcome/Landing screen.\n    *   User has a valid email address they can access for verification.\n    *   User has a network connection.\n\n---\n\n## 3. Sequence\n\n1.  **Screen:** Welcome Screen\n    *   **UI Elements:** App Logo, Tagline, \"Sign Up with Email\" button, \"Sign Up with Google\" button, \"Sign Up with Apple\" button, \"Log In\" link/button.\n    *   **User Action:** Taps \"Sign Up with Email\" button.\n    *   **Analytics:** [`flow_start: signup.email`], [`flow_step: signup.email_option_selected`]\n\n2.  **Transition:** Standard screen transition (e.g., slide).\n\n3.  **Screen:** Create Account (`lib/pages/auth/create_account.dart`)\n    *   **UI Elements:** \"Email Address\" input field, \"Password\" input field (secure entry), \"Confirm Password\" input field (secure entry), \"Create Account\" button (initially disabled). *(Note: Terms/Policy links not currently implemented in code)*.\n    *   **User Action (Email):** Enters email address into \"Email Address\" field. [`flow_step: signup.email_entered`]\n        *   **Validation (Real-time):** Checks if input is a valid email format (`^[\w-\.]+@([\w-]+\\.)+[\w-]{2,4}$`). Also checks domain for informational tier note (e.g., `.edu`, `buffalo.edu`).\n        *   **Design/UX Notes:** If format is invalid, show inline error message below field. Show informational note about email tier below field if valid.\n    *   **User Action (Password):** Enters password into \"Password\" field. [`flow_step: signup.password_entered`]\n        *   **Validation (Real-time):** Checks against complexity rules (see Q1 answer below). Displays visual strength indicator (bar + text: Weak/Medium/Strong).\n        *   **Design/UX Notes:** Secure text entry by default. Provide toggle icon to show/hide password.\n        *   **Password Complexity Rules (Q1 Answer):** Min 8 chars, requires combinations of: Uppercase (`A-Z`), Lowercase (`a-z`), Number (`0-9`), Special (`!@#$%^&*(),.?\":{}|<>`). Validation check (`_handleCreateAccount`) requires a calculated strength score >= 0.6 (effectively length + >=2 other categories).\n    *   **User Action (Confirm Password):** Enters password again into \"Confirm Password\" field. [`flow_step: signup.confirm_password_entered`]\n        *   **Validation (Real-time):** Checks if input matches the \"Password\" field value.\n        *   **Design/UX Notes:** If mismatch, show inline error message via SnackBar upon attempting submit.\n    *   **System Action:** Once all fields are valid (Email format OK, Password meets complexity, Confirm Password matches), enable the \"Create Account\" button.\n        *   **Design/UX Notes:** Button style: Primary Button per `hive_stylistic_system.md`.\n    *   **User Action:** Taps \"Create Account\" button. [`flow_step: signup.create_account_tapped`]\n        *   **System Action:** Display Loading State.\n        *   **Design/UX Notes:** **Loading Indicator (Q2 Answer):** Button shows a `CircularProgressIndicator` (spinner) when loading. *(Note: This conflicts with the \"no spinners\" guideline in `brand_aesthetic.md`)*. Button is disabled.\n        *   **API Call:** `POST /auth/signup/email` (Payload: `{ email, password }`) (Handled via `ref.read(authControllerProvider.notifier).createUserWithEmailPassword`)\n\n4.  **Branch:** API Response Handling\n    *   **IF (Success - User Created):** Proceed to Step 5.\n    *   **IF (Failure):** Proceed to Step 6.\n\n5.  **Screen:** Email Verification Required (Success Path) - *Implicitly handled by redirect*.\n    *   **UI Elements:** *(User is navigated away)* Success message (\"Account created successfully! Setting up your profile...\") shown via SnackBar *before* navigation.\n    *   **System Action:** Hide Loading State. Navigate to Onboarding Profile screen (`/onboarding`).\n    *   **Analytics:** [`flow_complete: signup.email`]\n    *   **(End of this specific flow - transitions to Onboarding Profile flow)**\n\n6.  **State:** Error Handling on Create Account Screen (Failure Path)\n    *   **System Action:** Hide Loading State. Re-enable \"Create Account\" button.\n    *   **Analytics:** [`flow_error: signup.email` (include error code/type)]\n    *   **Handle Specific Errors:** See Section 5 below.\n    *   **Design/UX Notes:** [Mobile] Trigger error haptic feedback (`notificationError`). Display error via SnackBar (see Q3/Q5 answer).\n\n---\n\n## 4. State Diagrams\n\n*   **Welcome Screen:** Initial state.\n*   **Create Account Screen:**\n    *   Initial: Fields empty, Create button disabled.\n    *   Inputting: Fields being filled, real-time validation occurs (email format, password strength indicator).\n    *   Validation Error (Email): Inline error message for email format.\n    *   Valid: All fields valid, Create button enabled.\n    *   Loading: Create button tapped, `CircularProgressIndicator` shown in button, button disabled.\n    *   API Error: SnackBar message displayed, Create button re-enabled.\n*   **(Success State Handled via Navigation)**\n\n---\n\n## 5. Error States & Recovery\n\n*   **Trigger:** Invalid input detected during real-time validation (Email format) or on attempting submit (Password mismatch, Password Strength < 0.6).\n    *   **State:** Error displayed via `SnackBar` (Toast). For Email format, inline error also shown.\n    *   **Recovery:** User corrects the input and retries submit.\n*   **Trigger:** API returns `FirebaseAuthException` code `invalid-email`.\n    *   **State:** Show error via SnackBar: \"Invalid email format\".\n    *   **Recovery:** User corrects email and retries.\n*   **Trigger:** API returns `FirebaseAuthException` code `weak-password`.\n    *   **State:** Show error via SnackBar: \"Password is too weak. Use at least 6 characters\". *(Note: Code enforces stricter rules locally)*.\n    *   **Recovery:** User corrects password and retries.\n*   **Trigger:** API returns `FirebaseAuthException` code `email-already-in-use`.\n    *   **State (Q3/Q5 Answer):** Display error via `SnackBar`: \"An account already exists with this email\".\n    *   **Recovery (Q4 Answer):** SnackBar includes a \"Login\" button (`SnackBarAction`) that navigates the user to the Login screen (`/login`).\n*   **Trigger:** API returns `500 Server Error` or other `FirebaseAuthException`.\n    *   **State (Q3/Q5 Answer):** Display error via `SnackBar` (e.g., `e.message ?? 'Authentication failed'`, \"An unexpected error occurred...\").\n    *   **Recovery:** User taps \"Create Account\" button again to retry.\n*   **Trigger:** Network Error / Timeout (`FirebaseAuthException` code `network-request-failed` or client-side detection).\n    *   **State (Q3/Q5 Answer):** Display error via `SnackBar`: \"Network error. Please check your connection and try again\".\n    *   **Recovery:** User taps \"Create Account\" button again to retry once connection is stable.\n\n---\n\n## 6. Acceptance Criteria\n\n*   **Pre-conditions:** User is on the Welcome Screen, not logged in.\n*   **Success Post-conditions:**\n    *   User account is created via Firebase Authentication.\n    *   *(Verification email sending is handled separately if needed based on email type)*\n    *   User is navigated to the Onboarding Profile screen (`/onboarding`).\n    *   `flow_complete: signup.email` event is logged.\n*   **Failure Post-conditions (e.g., Email Exists):**\n    *   User remains on the \"Create Account\" screen.\n    *   Appropriate error message (e.g., `email-already-in-use`) is displayed via SnackBar.\n    *   No account is created/modified.\n    *   `flow_error: signup.email` event is logged with error details.\n*   **General:**\n    *   All input fields validate correctly.\n    *   \"Create Account\" button is enabled only when all inputs are valid.\n    *   Password fields use secure text entry with a visibility toggle.\n    *   Loading and error states are displayed correctly (Loading indicator in button, errors via SnackBar).\n    *   **Terms/Policy Links (Q6 Answer):** Currently **not implemented** in the code for this screen. Needs to be added if required by design/legal.\n\n---\n\n## 7. Metrics & Analytics\n\n*   **Conversion Rate:** (# Reaching Onboarding Screen after email signup) / (# Tapping \"Sign Up with Email\")\n*   **Time-to-complete:** Median time from tapping \"Sign Up with Email\" to `flow_complete` or final `flow_error`. Target < 60s.\n*   **Error Rate:** Frequency of specific `FirebaseAuthException` codes (`invalid-email`, `weak-password`, `email-already-in-use`, `network-request-failed`) and other errors.\n*   **Analytics Events:**\n    *   `flow_start: signup.email`\n    *   `flow_step: signup.email_option_selected`\n    *   `flow_step: signup.email_entered`\n    *   `flow_step: signup.password_entered`\n    *   `flow_step: signup.confirm_password_entered`\n    *   `flow_step: signup.create_account_tapped`\n    *   `flow_complete: signup.email`\n    *   `flow_error: signup.email` (Properties: error_code, error_message)\n\n---\n\n## 8. Design/UX Notes\n\n*   Adhere to component styles (Buttons, Inputs) from `hive_stylistic_system.md`.\n*   Implement real-time validation feedback (inline message for email, password strength indicator).\n*   Use secure text entry for password fields. Include visibility toggle icon.\n*   Implement loading state on button using `CircularProgressIndicator`.\n*   Screen transitions should be standard (e.g., slide, 300ms duration, standard easing curve).\n*   [Mobile] Apply haptics: Light tap feedback on buttons, Error notification pattern on API/validation errors (via SnackBar display), Medium impact on successful account creation before navigation.\n*   Ensure accessibility: Semantic labels for inputs/buttons, clear focus indicators (`#EEB700` ring), sufficient color contrast.\n*   *(Action Item)*: If Terms/Policy links are required, implement them with clear tap targets and decide on in-app vs external browser opening and whether acceptance (checkbox) is needed.\n\n---\n\n## 9. API Calls & Data\n\n*   **Service Call:** `ref.read(authControllerProvider.notifier).createUserWithEmailPassword(email, password)` (Uses Firebase Auth backend).\n*   **Success Response:** User successfully created in Firebase Auth.\n*   **Error Responses:** Handled via `FirebaseAuthException` (codes: `invalid-email`, `weak-password`, `email-already-in-use`, `network-request-failed`, etc.).\n*   **Data Handling:** Requires active network connection.\n\n---\n\n## 10. Open Questions\n\n*   **(Resolved)** Q1: Password complexity rules defined in Section 3.\n*   **(Resolved)** Q2: Loading indicator is `CircularProgressIndicator` in button (violates guideline).\n*   **(Resolved)** Q3/Q5: Error UI is `SnackBar`.\n*   **(Resolved)** Q4: Yes, direct link to Login via `SnackBarAction` on `email-already-in-use` error.\n*   **(Resolved)** Q6: Terms/Policy links not currently implemented.\n\n*   **New Question:** Should the loading indicator on the button be changed from `CircularProgressIndicator` to align with the \"no spinners\" guideline in `brand_aesthetic.md` (e.g., text change or pulse)?\n*   **New Question:** If Terms/Policy links are added, how should they behave (in-app/external, checkbox required)?\n\n